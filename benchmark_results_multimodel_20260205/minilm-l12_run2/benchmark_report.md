# EphemeralML Benchmark Report

**Model:** MiniLM-L12-v2
**Hardware:** m6i.xlarge
**Commit:** f0b372a
**Timestamp:** 1770297102Z
**Iterations:** 100

## Stage Timing

| Stage | Bare Metal | Enclave | Overhead |
|-------|-----------|---------|----------|
| Attestation | N/A | 121.20ms | N/A (enclave-only) |
| KMS Key Release | N/A | 87.31ms | N/A (enclave-only) |
| Model Fetch | 51.76ms | 10489.53ms | +20165.7% |
| Model Decrypt | 160.48ms | 147.32ms | -8.2% |
| Model Load | 59.96ms | 57.81ms | -3.6% |
| Tokenizer Setup | 16.86ms | 24.22ms | +43.7% |
| Cold Start Total | 289.14ms | 10937.51ms | +3682.8% |

## Inference Latency

| Percentile | Bare Metal | Enclave | Overhead |
|-----------|-----------|---------|----------|
| Mean | 156.01ms | 178.38ms | +14.3% |
| P50 | 155.99ms | 177.53ms | +13.8% |
| P95 | 157.41ms | 184.50ms | +17.2% |
| P99 | 158.53ms | 195.98ms | +23.6% |
| Min | 154.42ms | 175.90ms | +13.9% |
| Max | 158.56ms | 197.04ms | +24.3% |
| Throughput | 6.4 inf/s | 5.6 inf/s | -12.5% |

## Memory Usage

| Metric | Bare Metal | Enclave | Overhead |
|--------|-----------|---------|----------|
| Peak RSS | 388.0 MB | 1494.1 MB | +285.1% |
| Model Size | 127.3 MB | 127.3 MB | - |

## VSock Communication (Enclave Only)

| Payload Size | RTT |
|-------------|-----|
| 64 bytes | 0.20ms |
| 1 KB | 0.19ms |
| 64 KB | 0.42ms |
| 1 MB | 4.42ms |
| **Upload Throughput** | **226.4 MB/s** |

## Output Quality Verification

**Reference text:** "What is the capital of France?"
**Embedding dimension:** 384
**Cosine similarity (full embedding):** 0.999999999999471
**Max abs diff (full embedding):** 7.451e-07
**Bit-identical (SHA-256):** no

Enclave produces **near-identical** embeddings (tiny FP-level differences).

## Cost Analysis

**Instance:** m6i.xlarge @ $0.192/hr (on-demand, us-east-1)

| Metric | Bare Metal | Enclave |
|--------|-----------|---------|
| Inferences/hour | 23,076 | 20,196 |
| Cost per 1K inferences | $0.0083 | $0.0095 |
| Cost per 1M inferences | $8.32 | $9.51 |
| Enclave cost multiplier | â€” | 1.14x |

## Summary

- **Inference overhead:** +14.3% (enclave vs bare metal)
- **Memory overhead:** +285.1% peak RSS
- **Attestation cost:** 121.2ms (one-time per session)
- **Cost per 1M inferences:** $9.51 (enclave on m6i.xlarge)

---
*Generated by `scripts/benchmark_report.py`*

## Security Primitives Overhead (Tier 4)

### HPKE Session Setup

| Operation | Mean | P50 | P95 | P99 |
|-----------|------|-----|-----|-----|
| Full session setup (both sides) | 0.1021ms | 0.0999ms | 0.1127ms | 0.1744ms |
| X25519 keypair generation | 0.0183ms | 0.0164ms | 0.0280ms | 0.0430ms |

### HPKE Encrypt/Decrypt Latency

| Payload | Encrypt Mean | Decrypt Mean | Total |
|---------|-------------|-------------|-------|
| 64B | 0.0021ms | 0.0020ms | 0.0041ms |
| 1KB | 0.0035ms | 0.0030ms | 0.0065ms |
| 64KB | 0.0613ms | 0.0785ms | 0.1398ms |
| 1MB | 1.3566ms | 1.2928ms | 2.6494ms |

### Receipt Generation & Verification

| Operation | Mean | P50 | P95 | P99 |
|-----------|------|-----|-----|-----|
| Ed25519 keypair generation | 0.0173ms | 0.0171ms | 0.0173ms | 0.0192ms |
| Receipt sign (CBOR + Ed25519) | 0.0220ms | 0.0219ms | 0.0221ms | 0.0223ms |
| Receipt verify | 0.0418ms | 0.0415ms | 0.0420ms | 0.0494ms |
| CBOR canonical encoding (568B) | 0.0013ms | 0.0013ms | 0.0013ms | 0.0014ms |

### Per-Inference Crypto Budget (1KB payload)

| Component | Cost |
|-----------|------|
| HPKE decrypt (request) | 0.0030ms |
| Receipt sign | 0.0220ms |
| HPKE encrypt (response) | 0.0035ms |
| **Total crypto overhead** | **0.0285ms** |

## Input Size Scaling

Measures inference latency as a function of input token count.

| Target Tokens | Actual Tokens | Mean | P50 | P95 | P99 |
|:---:|:---:|---:|---:|---:|---:|
| 32 | 32 | 42.43ms | 42.44ms | 43.04ms | 43.13ms |
| 64 | 63 | 75.40ms | 75.42ms | 75.89ms | 76.02ms |
| 128 | 128 | 168.05ms | 168.03ms | 168.74ms | 169.13ms |
| 256 | 256 | 446.98ms | 446.92ms | 449.54ms | 451.36ms |

**Linear fit:** latency = -36.75ms + 1.8369ms/token

## True End-to-End Latency

Full request path: HPKE encrypt + decrypt + BERT inference + receipt sign/verify.

| Metric | Mean | P50 | P95 | P99 |
|--------|------|-----|-----|-----|
| Session setup | 0.14ms | 0.14ms | 0.15ms | 0.17ms |
| Per-request E2E | 157.10ms | 157.05ms | 157.53ms | 159.01ms |
| Inference only | 156.80ms | 156.75ms | 157.25ms | 158.78ms |

**Crypto overhead per request:** 0.2952ms

## Enclave Concurrency Scaling

Full E2E path per request (HPKE + inference + receipt).

| Clients | Throughput | Mean Latency | P95 | Efficiency |
|:---:|---:|---:|---:|---:|
| 1 | 6.38 inf/s | 156.76ms | 157.91ms | 100.0% |
| 2 | 7.31 inf/s | 273.56ms | 281.79ms | 57.3% |
| 4 | 7.31 inf/s | 545.64ms | 618.61ms | 28.6% |

## Quality Determinism

**Baseline:** 1 runs, deterministic=Yes, unique SHA-256 count=1
**Enclave:** 1 runs, deterministic=Yes, unique SHA-256 count=1

**Cross-environment:** near-identical (f32 precision)
  - Cosine similarity: min=0.999999999999
  - Max abs diff: max=7.451e-07
