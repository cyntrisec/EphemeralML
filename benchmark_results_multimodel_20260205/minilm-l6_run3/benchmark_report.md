# EphemeralML Benchmark Report

**Model:** MiniLM-L6-v2
**Hardware:** m6i.xlarge
**Commit:** 8fc6c36
**Timestamp:** 1770324674Z
**Iterations:** 100

## Stage Timing

| Stage | Bare Metal | Enclave | Overhead |
|-------|-----------|---------|----------|
| Attestation | N/A | 299.63ms | N/A (enclave-only) |
| KMS Key Release | N/A | 82.87ms | N/A (enclave-only) |
| Model Fetch | 35.04ms | 5727.77ms | +16246.4% |
| Model Decrypt | 109.09ms | 100.96ms | -7.5% |
| Model Load | 41.73ms | 40.10ms | -3.9% |
| Tokenizer Setup | 16.84ms | 24.53ms | +45.7% |
| Cold Start Total | 202.78ms | 6283.81ms | +2998.8% |

## Inference Latency

| Percentile | Bare Metal | Enclave | Overhead |
|-----------|-----------|---------|----------|
| Mean | 78.92ms | 90.59ms | +14.8% |
| P50 | 78.71ms | 90.24ms | +14.6% |
| P95 | 80.81ms | 93.14ms | +15.3% |
| P99 | 81.21ms | 96.39ms | +18.7% |
| Min | 77.53ms | 88.37ms | +14.0% |
| Max | 81.69ms | 96.59ms | +18.2% |
| Throughput | 12.7 inf/s | 11.0 inf/s | -12.9% |

## Memory Usage

| Metric | Bare Metal | Enclave | Overhead |
|--------|-----------|---------|----------|
| Peak RSS | 265.9 MB | 585.6 MB | +120.2% |
| Model Size | 86.7 MB | 86.7 MB | - |

## VSock Communication (Enclave Only)

| Payload Size | RTT |
|-------------|-----|
| 64 bytes | 0.17ms |
| 1 KB | 0.14ms |
| 64 KB | 0.39ms |
| 1 MB | 4.41ms |
| **Upload Throughput** | **226.6 MB/s** |

## Output Quality Verification

**Reference text:** "What is the capital of France?"
**Embedding dimension:** 384
**Cosine similarity (full embedding):** 0.999999999999871
**Max abs diff (full embedding):** 5.811e-07
**Bit-identical (SHA-256):** no

Enclave produces **near-identical** embeddings (tiny FP-level differences).

## Cost Analysis

**Instance:** m6i.xlarge @ $0.192/hr (on-demand, us-east-1)

| Metric | Bare Metal | Enclave |
|--------|-----------|---------|
| Inferences/hour | 45,612 | 39,744 |
| Cost per 1K inferences | $0.0042 | $0.0048 |
| Cost per 1M inferences | $4.21 | $4.83 |
| Enclave cost multiplier | â€” | 1.15x |

## Summary

- **Inference overhead:** +14.8% (enclave vs bare metal)
- **Memory overhead:** +120.2% peak RSS
- **Attestation cost:** 299.6ms (one-time per session)
- **Cost per 1M inferences:** $4.83 (enclave on m6i.xlarge)

---
*Generated by `scripts/benchmark_report.py`*

## Security Primitives Overhead (Tier 4)

### HPKE Session Setup

| Operation | Mean | P50 | P95 | P99 |
|-----------|------|-----|-----|-----|
| Full session setup (both sides) | 0.1004ms | 0.0996ms | 0.1065ms | 0.1148ms |
| X25519 keypair generation | 0.0165ms | 0.0163ms | 0.0165ms | 0.0248ms |

### HPKE Encrypt/Decrypt Latency

| Payload | Encrypt Mean | Decrypt Mean | Total |
|---------|-------------|-------------|-------|
| 64B | 0.0022ms | 0.0020ms | 0.0042ms |
| 1KB | 0.0031ms | 0.0029ms | 0.0060ms |
| 64KB | 0.0606ms | 0.0769ms | 0.1375ms |
| 1MB | 1.3475ms | 1.2862ms | 2.6337ms |

### Receipt Generation & Verification

| Operation | Mean | P50 | P95 | P99 |
|-----------|------|-----|-----|-----|
| Ed25519 keypair generation | 0.0172ms | 0.0171ms | 0.0173ms | 0.0174ms |
| Receipt sign (CBOR + Ed25519) | 0.0224ms | 0.0220ms | 0.0222ms | 0.0347ms |
| Receipt verify | 0.0437ms | 0.0434ms | 0.0439ms | 0.0509ms |
| CBOR canonical encoding (568B) | 0.0013ms | 0.0013ms | 0.0013ms | 0.0014ms |

### Per-Inference Crypto Budget (1KB payload)

| Component | Cost |
|-----------|------|
| HPKE decrypt (request) | 0.0029ms |
| Receipt sign | 0.0224ms |
| HPKE encrypt (response) | 0.0031ms |
| **Total crypto overhead** | **0.0284ms** |

## Input Size Scaling

Measures inference latency as a function of input token count.

| Target Tokens | Actual Tokens | Mean | P50 | P95 | P99 |
|:---:|:---:|---:|---:|---:|---:|
| 32 | 32 | 23.61ms | 23.48ms | 25.81ms | 27.26ms |
| 64 | 63 | 41.82ms | 41.63ms | 44.15ms | 45.03ms |
| 128 | 128 | 89.73ms | 89.71ms | 91.52ms | 92.23ms |
| 256 | 256 | 240.63ms | 240.27ms | 245.64ms | 247.95ms |

**Linear fit:** latency = -18.89ms + 0.9840ms/token

## True End-to-End Latency

Full request path: HPKE encrypt + decrypt + BERT inference + receipt sign/verify.

| Metric | Mean | P50 | P95 | P99 |
|--------|------|-----|-----|-----|
| Session setup | 0.14ms | 0.14ms | 0.16ms | 0.18ms |
| Per-request E2E | 80.09ms | 80.07ms | 81.51ms | 82.17ms |
| Inference only | 79.78ms | 79.75ms | 81.16ms | 81.86ms |

**Crypto overhead per request:** 0.3156ms

## Enclave Concurrency Scaling

Full E2E path per request (HPKE + inference + receipt).

| Clients | Throughput | Mean Latency | P95 | Efficiency |
|:---:|---:|---:|---:|---:|
| 1 | 12.46 inf/s | 80.24ms | 82.30ms | 100.0% |
| 2 | 14.41 inf/s | 138.77ms | 144.63ms | 57.8% |
| 4 | 14.29 inf/s | 277.29ms | 323.75ms | 28.7% |

## Quality Determinism

**Baseline:** 1 runs, deterministic=Yes, unique SHA-256 count=1
**Enclave:** 1 runs, deterministic=Yes, unique SHA-256 count=1

**Cross-environment:** near-identical (f32 precision)
  - Cosine similarity: min=1.000000000000
  - Max abs diff: max=5.811e-07
